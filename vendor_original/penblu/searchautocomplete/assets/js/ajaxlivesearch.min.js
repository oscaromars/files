!function(e){"use strict";e.fn.ajaxlivesearch=function(a){if(void 0===a.loaded_at)throw"loaded_at must be defined";if(void 0===a.token)throw"token must be defined";var s={url:"core/AjaxProcessor.php",form_anti_bot:"ajaxlivesearch_guard",cache:!1,form_anti_bot_class:"ls_anti_bot",footer_class:"ls_result_footer",next_page_class:"ls_next_page",previous_page_class:"ls_previous_page",page_limit:"page_limit",result_wrapper_class:"ls_result_div",result_class:"ls_result_main",container_class:"ls_container",pagination_class:"pagination",form_class:"search",loaded_at_class:"ls_page_loaded_at",token_class:"ls_token",current_page_hidden_class:"ls_current_page",current_page_lbl_class:"ls_current_page_lbl",last_page_lbl_class:"ls_last_page_lbl",total_page_lbl_class:"ls_last_page_lbl",page_range_class:"ls_items_per_page",page_ranges:[0,5,10],page_range_default:5,navigation_class:"navigation",arrow_class:"arrow",slide_speed:"fast",type_delay:350,max_input:20,min_chars_to_search:0,fncallback:""};function t(e,a){e.hide(),a.find("table").addClass("border_radius")}function l(e,a){a.find("table").removeClass("border_radius"),e.show()}function r(e,a,s){if(void 0===e||void 0===s)throw"Form or Options is missing";var t="."+s.current_page_hidden_class;switch(a){case"result":return e.find("."+s.result_wrapper_class);case"footer":return e.find("."+s.footer_class);case"arrow":return e.find("."+s.arrow_class);case"navigation":return e.find("."+s.navigation_class);case"current_page":return e.find(t);case"current_page_lbl":return e.find("."+s.current_page_lbl_class);case"total_page_lbl":return e.find("."+s.total_page_lbl_class);case"page_range":return e.find("."+s.page_range_class);default:throw"Key: "+a+" is not found"}}function i(e,a){e.slideUp(a.slide_speed)}function n(e,a){e.slideDown(a.slide_speed)}function o(a,o,c,_,d,u){u=u||!1;var v=r(o,"result",c);if(e.trim(a.value).length&&e.trim(a.value).length>=c.min_chars_to_search||1==u){if(_||a.latest_value!==a.value||1==u){if(d){var p=r(o,"current_page",c),h=r(o,"current_page_lbl",c);p.val("1"),h.html("1")}a.selected_row=void 0,a.to_be_executed&&clearTimeout(a.to_be_executed),a.to_be_executed=setTimeout(function(){if(e.trim(a.value).length||1==u){e(a).addClass("ajax_loader");var i=r(o,"navigation",c),_=r(o,"total_page_lbl",c),d=r(o,"page_range",c),p=r(o,"footer",c),h=e(o).serializeArray(),f=e(a).data();e.each(f,function(e,a){var s={};s.name=e,s.value=a,h.push(s)}),e.ajax({type:"post",url:s.url,data:h,dataType:"json",cache:s.cache,success:function(e){if("success"===e.status){var a=e.result;if(v.find("table tbody").html(a.html),0===a.number_of_results)t(p,v);else{a.total_pages>1?(i.show(),_.html(a.total_pages)):i.hide();var s=function(e){var a,s,t=e.find("option");for(s=0;s<t.length;s+=1)void 0===a&&0!==parseInt(t[s].value)?a=t[s].value:parseInt(t[s].value)<parseInt(a)&&0!==parseInt(t[s].value)&&(a=t[s].value);return a}(d);p.is(":visible")?parseInt(a.number_of_results)<=parseInt(s)?t(p,v):l(p,v):parseInt(a.number_of_results)>parseInt(s)?l(p,v):t(p,v)}}else v.find("table tbody").html(e.message),t(p,v)},error:function(){v.find("table tbody").html("Something went wrong. Please refresh the page."),t(p,v)},complete:function(s){if(e.trim(a.value).length&&v.is(":hidden")&&n(v,c),e(a).removeClass("ajax_loader"),void 0!==c.onAjaxComplete){var t={this:this};c.onAjaxComplete(s,t)}}})}},s.type_delay)}}else(v.is(":visible")||v.is(":animated"))&&i(v,c);a.latest_value=a.value}return s=e.extend(s,a),this.each(function(){var t=e(this),l=t.attr("id");!function(e,a){var s=e.attr("id");e.attr("autocomplete","off"),e.attr("name","ls_query"),e.addClass("ls_query"),e.attr("maxlength",a.max_input);var t,l,r="",i="";for(t=0;t<a.page_ranges.length;t+=1)i=0===(l=a.page_ranges[t])?"All":l,r+='<option value="'+l+'" '+(a.page_range_default===l?"selected":"")+">"+i+"</option>";var n='<div class="'+a.footer_class+'"><div class="col '+a.page_limit+'"><select name="ls_items_per_page" class="'+a.page_range_class+'">'+r+'</select></div><div class="col '+a.navigation_class+'"><i class="icon-left-circle '+a.arrow_class+" "+a.previous_page_class+'"></i></div><div class="col '+a.navigation_class+" "+a.pagination_class+'"><label class="'+a.current_page_lbl_class+'">1</label> / <label class="'+a.last_page_lbl_class+'"></label></div><div class="col '+a.navigation_class+'"><i class="icon-right-circle '+a.arrow_class+" "+a.next_page_class+'"></i></div></div>',o='<div class="'+a.container_class+'"><form accept-charset="UTF-8" class="'+a.form_class+'" id="'+a.form_class+"_"+s+'" name="ls_form"></form></div>',c='<input type="hidden" name="ls_anti_bot" class="'+a.form_anti_bot_class+'" value=""><input type="hidden" name="ls_token" class="'+a.token_class+'" value="'+a.token+'"><input type="hidden" name="ls_page_loaded_at" class="'+a.loaded_at_class+'" value="'+a.loaded_at+'"><input type="hidden" name="ls_current_page" class="'+a.current_page_hidden_class+'" value="1"><input type="hidden" name="ls_query_id" value="'+s+'">',_='<div class="'+a.result_wrapper_class+'"><div class="'+a.result_class+'"><table><tbody></tbody></table></div>'+n+"</div>";e.wrap(o),e.before(c),e.after(_)}(t,s);var c,_=e("#"+s.form_class+"_"+l),d=r(_,"result",s),u=r(_,"arrow",s),v=r(_,"current_page",s),p=r(_,"current_page_lbl",s),h=r(_,"total_page_lbl",s),f=r(_,"page_range",s);t.on("click",function(e){e.keyCode||e.which;""!=t.val()&&""==t.attr("data-value")||(o(this,_,s,!1,!0,!0),n(d,s),t.attr("data-value","")),d.css({left:t.position().left+1,width:t.outerWidth()-2})}),t.on("keyup",function(l){var r=l.keyCode||l.which;if(e.trim(t.val()).length&&13===r){if(!d.is(":visible")&&!d.is(":animated")||0===parseInt(d.find("tr").length))n(d,s);else if(void 0!==t.selected_row){var i={selected:e(t.selected_row),this:this,searchField:t};void 0!==a.onResultEnter&&a.onResultEnter(l,i)}}else o(this,_,s,!1,!0)}),t.on("keydown",function(a){var l=a.keyCode||a.which;if(40===l||38===l)return e.trim(t.val()).length&&0!==d.find("tr").length&&(d.is(":visible")||d.is(":animated")?(d.find("tr").removeClass("hover"),void 0===t.selected_row?(t.selected_row=d.find("tr").eq(0),e(t.selected_row).addClass("hover")):(e(t.selected_row).removeClass("hover"),40===l?0===e(t.selected_row).next().length?(t.selected_row=d.find("tr").eq(0),e(t.selected_row).addClass("hover")):(e(t.selected_row).next().addClass("hover"),t.selected_row=e(t.selected_row).next()):0===e(t.selected_row).prev().length?(t.selected_row=d.find("tr").last(),t.selected_row.addClass("hover")):(e(t.selected_row).prev().addClass("hover"),t.selected_row=e(t.selected_row).prev()))):40===l&&n(d,s)),!1}),t.on("focus",function(){e.trim(t.val()).length&&(d.is(":hidden")||d.is(":animated"))&&0!==d.find("tr").length&&(o(this,_,s,!1,!0),n(d,s))}),d.on("mouseover","tr",function(){d.find("tr").removeClass("hover"),t.selected_row=this,e(this).addClass("hover")}),d.on("mouseleave","tr",function(){d.find("tr").removeClass("hover"),t.selected_row=void 0}),_.submit(function(){return!1}),u.on("click",function(){var a;if(e(this).hasClass(s.next_page_class)){if(!(parseInt(v.val(),10)+1<=parseInt(h.html(),10)))return;a=parseInt(v.val(),10)+1}else{if(!(parseInt(v.val(),10)-1>=1))return;a=parseInt(v.val(),10)-1}v.val(a),p.html(a),o(t[0],_,s,!0,!1,!0)}),f.on("change",function(){o(t[0],_,s,!0,!0,!0)}),d.css({left:t.position().left+1,width:t.outerWidth()-2}),e(window).resize(function(){d.css({left:t.position().left+1,width:t.outerWidth()-2})}),e(document).bind("touchstart",function(){c=e(window).scrollTop()}).bind("touchend",function(a){var l;l=c-e(window).scrollTop(),e(document).addClass("touched"),l<10&&l>-10&&(e(a.target).closest(d).length||e(a.target).is(t)||!e(d).is(":visible")||i(d,s))}),e(document).on("click",function(a){e(this).hasClass("touched")?e(this).removeClass("touched"):e(a.target).closest(d).length||e(a.target).is(t)||!e(d).is(":visible")||i(d,s)}),e(d).on("click","tr",function(s){var l={selected:e(t.selected_row),this:this,searchField:t};void 0!==a.onResultClick&&a.onResultClick(s,l)}),e(this).on("ajaxlivesearch:hide_result",function(){i(d,s)}),e(this).on("ajaxlivesearch:search",function(a,t){e(this).val(t.query),o(this,_,s,!0,!0)})}),e("."+s.form_anti_bot_class).val(s.form_anti_bot),this}}(jQuery);
